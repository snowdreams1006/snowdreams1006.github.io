# GoAccesså¸¸è§é—®é¢˜

![å¾®ä¿¡å…¬ä¼—å·ã€Œé›ªä¹‹æ¢¦æŠ€æœ¯é©¿ç«™ã€](https://s2.loli.net/2024/07/23/CHsWfznEuPXTOJZ.gif)

---

**è‡´è¯»è€…**: ç‚¹å‡»ä¸Šæ–¹ â€œé›ªä¹‹æ¢¦æŠ€æœ¯é©¿ç«™â€ â†’ ç‚¹å‡»å³ä¸Šè§’â€œ ... â€â†’ ç‚¹é€‰â€œè®¾ä¸ºæ˜Ÿæ ‡â˜…Â â€ åŠ ä¸Šæ˜Ÿæ ‡ï¼Œå°±ä¸ä¼šæ‰¾ä¸åˆ°æˆ‘å•¦ï¼  

> å·å·æºœè¿›æ–‡ç« çš„å°å¹¿å‘Šï¼Œåˆ«å®³ç¾ï¼Œç‚¹è¿›å»ç…ç…ï¼Œè¯´ä¸å®šèƒ½å‘ç°ä»€ä¹ˆå®è—å‘¢ï¼æ–‡æœ«é‚£ä¸ªä¹Ÿåˆ«é”™è¿‡ï¼Œè¯´ä¸å®šæ˜¯é€šå¾€ç§˜å¯†èŠ±å›­çš„é’¥åŒ™å“¦ï¼

ğŸŒŸ å¤§å®¶å¥½ï¼Œæ¬¢è¿æ¥åˆ°ã€Œé›ªä¹‹æ¢¦æŠ€æœ¯é©¿ç«™ã€

ğŸš€ ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥ä¸€åœºè¯´èµ°å°±èµ°çš„GoAccessæ¢é™©ä¹‹æ—…ï¼Œä¸ä»…æ­ç§˜é‚£äº›è®©ä½ å¤´ç–¼ä¸å·²çš„é—®é¢˜ï¼Œè¿˜äº²æ‰‹ä¸ºä½ é“ºè®¾ä¸€æ¡ä»æ–°æ‰‹åˆ°é«˜æ‰‹çš„å¿«é€Ÿé€šé“ã€‚

> GoAccess æ˜¯ä¸€æ¬¾å¼€æºçš„ä¸”å…·æœ‰äº¤äº’è§†å›¾ç•Œé¢çš„å®æ—¶ Web æ—¥å¿—åˆ†æå·¥å…·ï¼Œé€šè¿‡ä½ çš„ Web æµè§ˆå™¨æˆ–è€… *nix ç³»ç»Ÿä¸‹çš„ç»ˆç«¯ç¨‹åº(terminal)å³å¯è®¿é—®ã€‚
> 
> èƒ½ä¸ºç³»ç»Ÿç®¡ç†å‘˜æä¾›å¿«é€Ÿä¸”æœ‰ä»·å€¼çš„ HTTP ç»Ÿè®¡ï¼Œå¹¶ä»¥åœ¨çº¿å¯è§†åŒ–æœåŠ¡å™¨çš„æ–¹å¼å‘ˆç°ã€‚
>
> æ‘˜å½•è‡ªä¸­æ–‡ç¿»è¯‘ç½‘ç«™: [https://www.goaccess.cc/](https://www.goaccess.cc/)

æ— è®ºä½ æ˜¯åˆšå¼€å§‹æ¥è§¦æ—¥å¿—åˆ†æçš„æ–°æ‰‹ï¼Œè¿˜æ˜¯æƒ³è¦æå‡æ•ˆç‡çš„è€é¸Ÿï¼Œè¿™ç¯‡æ–‡ç« éƒ½å°†æ˜¯ä½ ä¸å¯å¤šå¾—çš„å®è—åœ°å›¾ï¼

![](https://s2.loli.net/2024/07/30/MrWHCALBV63jcf1.png)

ğŸ” é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç›´å‡»ç—›ç‚¹ï¼ŒèŠèŠé‚£äº›åœ¨ä½¿ç”¨GoAccessè¿‡ç¨‹ä¸­ï¼Œä½ æœ€å¯èƒ½é‡åˆ°çš„å‡ ä¸ªâ€˜å‘â€™ï¼š

- é…ç½®è¿·èŒ«ï¼šé¢å¯¹å¤æ‚çš„é…ç½®æ–‡ä»¶ï¼Œæ˜¯ä¸æ˜¯å¸¸å¸¸æ„Ÿåˆ°æ— ä»ä¸‹æ‰‹ï¼Œä¸çŸ¥é“å“ªäº›è®¾ç½®æ‰æ˜¯æœ€é€‚åˆè‡ªå·±çš„éœ€æ±‚ï¼Ÿ
- æ€§èƒ½ç“¶é¢ˆï¼šéšç€æ•°æ®é‡çš„æ¿€å¢ï¼ŒGoAccessæ˜¯å¦è¿˜èƒ½ä¿æŒå…¶è½»ç›ˆçš„èº«å§¿ï¼Œæµç•…åœ°å±•ç¤ºåˆ†æç»“æœï¼Ÿ
- æ•°æ®å¯¼å…¥éš¾é¢˜ï¼šå¦‚ä½•å°†Nginxã€Apacheç­‰æœåŠ¡å™¨çš„æ—¥å¿—æ–‡ä»¶æ— ç¼å¯¼å…¥GoAccessï¼Œå®ç°ä¸€é”®åˆ†æï¼Ÿ
- æŠ¥è¡¨å®šåˆ¶ï¼šå¦‚ä½•æ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼Œå®šåˆ¶å‡ºæ—¢ç¾è§‚åˆå®ç”¨çš„æŠ¥è¡¨ï¼Œè®©æ•°æ®è¯´è¯æ›´æœ‰åŠ›ï¼Ÿ

![](https://s2.loli.net/2024/07/30/wF3bjHDAqUm9s1z.png)

ğŸ‰ å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·è¸ä¸Šè¿™åœºå……æ»¡æŒ‘æˆ˜ä¸æ”¶è·çš„æ—…ç¨‹ï¼Œè®©GoAccessæˆä¸ºä½ æ—¥å¿—åˆ†æé¢†åŸŸçš„å¾—åŠ›åŠ©æ‰‹ï¼

```bash
# ç”Ÿæˆä¸€ä»½ HTML æŠ¥å‘Š
goaccess access.log -a -o report.html
```

> è¯¦ç»†é…ç½®é€‰é¡¹è¯·å‚è€ƒ[å®˜æ–¹ç”¨æˆ·æ‰‹å†Œ](https://goaccess.io/man)

## å¸¸ç”¨é…ç½®

### è¯­è¨€æ—¶åŒºç­‰è®¾ç½®

> é»˜è®¤è‹±æ–‡ç¯å¢ƒ,éœ€æ±‚ä¸ºæ›´æ”¹ä¸ºä¸­æ–‡ç¯å¢ƒ `zh_CN.UTF-8`

å¦‚æœç³»ç»Ÿæ˜¯è‹±æ–‡ç¯å¢ƒåˆ™GoAccessæ—¥å¿—ç›‘æµ‹æŠ¥å‘Šä¹Ÿæ˜¯è‹±æ–‡,æŸ¥çœ‹é»˜è®¤`echo $LANG`ç¯å¢ƒå˜é‡!

![](https://s2.loli.net/2024/07/30/wZLpnh4CzGQSt1y.png)

æ‰€ä»¥æƒ³è¦GoAccessæ˜¾ç¤ºä¸­æ–‡,åªéœ€è¦å°†ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºä¸­æ–‡å³å¯ `LANG="zh_CN.UTF-8"
`

![](https://s2.loli.net/2024/07/30/4Z8F2mEawXxoYrH.png)

### è¯·æ±‚çš„æ–‡ä»¶

> è¯·æ±‚é“¾æ¥æºå¸¦å‚æ•°,éœ€æ±‚ä¸ºå¿½ç•¥è¯·æ±‚å‚æ•°,ç²¾ç®€getè¯·æ±‚url

å¦‚æœæ˜¯getè¯·æ±‚ä¼šæºå¸¦å¤§é‡çš„å‚æ•°,ä¹Ÿä¼šå±•ç¤ºå¤šæ¡è®°å½•,æ˜¾å¾—éå¸¸å‡Œä¹±,å› æ­¤éœ€è¦å¿½ç•¥`query`å‚æ•°éƒ¨åˆ†

![](https://s2.loli.net/2024/07/30/3YmAesCRlu7KWpE.png)

```bash
-q --no-query-string
Ignore request's query string. i.e., www.google.com/page.htm?query => www.google.com/page.htm
Note: Removing the query string can greatly decrease memory consumption, especially on timestamped requests.
```

![](https://s2.loli.net/2024/07/30/yS9VYOM4BxWRoUa.png)

### è®¿å®¢ä¸»æœºåå’ŒIPåœ°å€

> åªèƒ½çœ‹åˆ°å…·ä½“çš„ipæ•°æ®,æ— æ³•ç›´è§‚æŸ¥çœ‹ipå½’å±åœ°,éœ€æ±‚æ˜¯è§£æipåœ°ç†ä½ç½®

![](https://s2.loli.net/2024/07/30/qLtAca4PWMUxoZz.png)

å¼€å¯åœ°ç†ä½ç½®è§£æ,æŒ‡å®šç¦»çº¿ipæ•°æ®åº“æ–‡ä»¶,å…·ä½“æ“ä½œå¯å‚è€ƒ: [
ä½ çš„ç½‘ç«™è®¿å®¢æ¥è‡ªä½•æ–¹ï¼ŸGoAccessåœ°ç†åˆ†æå·¥å…·å‘Šè¯‰ä½ ï¼
](https://mp.weixin.qq.com/s?__biz=MzU3NTc1MDMwOQ==&mid=2247484416&idx=1&sn=769d951e80b61b6d9de4d543dfab0a96&chksm=fd1f2dcaca68a4dcc06c741978d3555ad4c2d2cce58cecbdbdfdc0e1278be084c592b1aa7dfd&payreadticket=HPngiD-UJKeCAaCwZrsulpfCXcsReG31BBb2pK7Y7kvegRli5-tvNc2o41Uv2HJnT74VSyI#rd)

```bash
--geoip-database <geocityfile>
Specify path to GeoIP database file. i.e., GeoLiteCity.dat. File needs to be downloaded from maxmind.com. IPv4 and IPv6 files are supported as well. Note: --geoip-city-data is an alias of --geoip-database.
Note: If using GeoIP2, you will need to download the City/Country database from MaxMind and use the option --geoip-database to specify the database. Currently cities are only shown in the hosts panel (per host).
```

![](https://s2.loli.net/2024/07/30/dntG25vVMqlNFKL.png)

### æ“ä½œç³»ç»Ÿ

> æœªçŸ¥æ•°æ®`Unknown`å•ç‹¬å æ¯”æ˜¯ä¸å¤ªç§‘å­¦çš„,éœ€æ±‚æ˜¯å½’ç±»ä¸ºçˆ¬è™«`Crawlers`è®°å½•

![](https://s2.loli.net/2024/07/30/aVFgZNpnIqMYQ8X.png)

```bash
--unknowns-as-crawlers
Classify unknown OS and browsers as crawlers. As an attempt to detect non-humans more accurately, an option to classify unknown OS and browsers and crawlers help.
```

![](https://s2.loli.net/2024/07/30/wsk3AYeuM9Gi2WF.png)

### æ—¶é—´åˆ†é…

> é»˜è®¤æŒ‰ç…§å°æ—¶ç»Ÿè®¡,ç‰¹æ®Šæƒ…å†µä¸‹ä¹Ÿå¯ä»¥æŒ‡å®šæŒ‰ç…§åˆ†é’Ÿç»Ÿè®¡

![](https://s2.loli.net/2024/07/30/WUTzIM4xmjvdHRS.png)

```bash
--hour-spec=<hour|min>
Set the time specificity to either hour (default) or min to display the tenth of an hour appended to the hour.
This is used in the time distribution panel. It's useful for tracking peaks of traffic on your server at specific times.
```

![](https://s2.loli.net/2024/07/30/Ev2F5d9GtxizqZo.png)

### åœ°ç†ä½ç½®

> éœ€è¦å¼€å¯åœ°ç†ä½ç½®é€‰é¡¹,æ¥æºäºè§£æipå¯¹åº”çš„åœ°ç†ä½ç½®ç»Ÿè®¡å±•ç¤ºçš„æ•°æ®,å¦åˆ™æ²¡æœ‰è¯¥é¢æ¿.

```bash
--geoip-database <geocityfile>
Specify path to GeoIP database file. i.e., GeoLiteCity.dat. File needs to be downloaded from maxmind.com. IPv4 and IPv6 files are supported as well. Note: --geoip-city-data is an alias of --geoip-database.
Note: If using GeoIP2, you will need to download the City/Country database from MaxMind and use the option --geoip-database to specify the database. Currently cities are only shown in the hosts panel (per host).
```

![](https://s2.loli.net/2024/07/30/Q7a1ViAZgj8usIS.png)

å…·ä½“æ“ä½œå¯å‚è€ƒ: [
ä½ çš„ç½‘ç«™è®¿å®¢æ¥è‡ªä½•æ–¹ï¼ŸGoAccessåœ°ç†åˆ†æå·¥å…·å‘Šè¯‰ä½ ï¼
](https://mp.weixin.qq.com/s?__biz=MzU3NTc1MDMwOQ==&mid=2247484416&idx=1&sn=769d951e80b61b6d9de4d543dfab0a96&chksm=fd1f2dcaca68a4dcc06c741978d3555ad4c2d2cce58cecbdbdfdc0e1278be084c592b1aa7dfd&payreadticket=HPngiD-UJKeCAaCwZrsulpfCXcsReG31BBb2pK7Y7kvegRli5-tvNc2o41Uv2HJnT74VSyI#rd)

## æ€»ç»“

æœ¬æ–‡ä¸»è¦ä»‹ç»äº†GoAccessä½¿ç”¨è¿‡ç¨‹ä¸­çš„å…³äºé¢æ¿çš„å¸¸ç”¨é…ç½®é€‰é¡¹,åå¤æŸ¥çœ‹é…ç½®æ–‡æ¡£çš„åè¡€æ€»ç»“,äº‰å–æ–°äººä¸ç”¨å†çœ‹ç¹ççš„ç”¨æˆ·æ‰‹å†Œå°±èƒ½ç›´æ¥ä¸Šæ‰‹.

å¦‚æœæ˜¯æ‚¨æ­£åœ¨ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„`nginx`æ—¥å¿—æ ¼å¼,é‚£ä¹ˆæ¥ä¸‹æ¥çš„å‘½ä»¤å¯ä»¥å‚è€ƒä½¿ç”¨.è¯·å…ˆç¡®è®¤`nginx`æ—¥å¿—æ ¼å¼ `--log-format=COMBINED`

```bash
http {
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;
    ...    
}
```

å¦‚æœæ˜¯å…¶ä»–webæ—¥å¿—æ ¼å¼,è¯·å‚è€ƒ[https://goaccess.io/man](https://goaccess.io/man)

```bash
--log-format <logformat>
The log-format variable followed by a space or \t for tab-delimited, specifies the log format string.

In addition to specifying the raw log/date/time formats, for simplicity, any of the following predefined log format names can be supplied to the log/date/time-format variables. GoAccess can also handle one predefined name in one variable and another predefined name in another variable.

COMBINED     | è”åˆæ—¥å¿—æ ¼å¼
VCOMBINED    | æ”¯æŒè™šæ‹Ÿä¸»æœºçš„è”åˆæ—¥å¿—æ ¼å¼
COMMON       | é€šç”¨æ—¥å¿—æ ¼å¼
VCOMMON      | æ”¯æŒè™šæ‹Ÿä¸»æœºçš„é€šç”¨æ—¥å¿—æ ¼å¼
W3C          | W3C æ‰©å±•æ—¥å¿—æ ¼å¼
SQUID        | Native Squid æ—¥å¿—æ ¼å¼
CLOUDFRONT   | äºšé©¬é€Š CloudFront Web åˆ†å¸ƒå¼ç³»ç»Ÿ
CLOUDSTORAGE | è°·æ­Œäº‘å­˜å‚¨
AWSELB       | äºšé©¬é€Šå¼¹æ€§è´Ÿè½½å‡è¡¡
AWSS3        | äºšé©¬é€Šç®€å•å­˜å‚¨æœåŠ¡ (S3)
```

æœ€å,é™æ€æŠ¥å‘ŠåŸºæœ¬å‘½ä»¤å¦‚ä¸‹:

```bash
# é™æ€æŠ¥å‘Š
goaccess /var/log/nginx/access.log --log-format=COMBINED \
 # ipåœ°ç†è§£ææ•°æ®åº“æ–‡ä»¶
 --geoip-database=/GeoLite2-City.mmdb \
 # ipåœ°ç†è§£ææ•°æ®åº“æ–‡ä»¶
 --geoip-database=/GeoLite2-City.mmdb \
 # å¿½ç•¥GETè¯·æ±‚æŸ¥è¯¢å‚æ•°
 -q \
 # æœªçŸ¥ç”¨æˆ·ä»£ç†è®¾ä¸ºçˆ¬è™«
 --unknowns-as-crawlers
 # è¾“å‡ºåˆ°webé™æ€è·¯å¾„
 -o /var/www/html/report.html

```

> å®æ—¶æŠ¥å‘Šå¦‚ä¸‹,éœ€è¦é…ç½®`websocket`ç­‰é€‰é¡¹,å…³æ³¨ä¸Šä¸€ç¯‡å†å²æ–‡ç« æœ‰ä¸“é—¨çš„è¯¦ç»†ä»‹ç»!

```bash
goaccess /var/log/nginx/access.log --log-format=COMBINED \
 # å®æ—¶æ—¥å¿—ç›¸å…³é…ç½®
 --real-time-html \
 --ws-url=wss://js56.cn:443/goaccess/webSocket \
 --origin=https://js56.cn \
 --port=7890 \
 --ping-interval=60 \
 # ipåœ°ç†è§£ææ•°æ®åº“æ–‡ä»¶
 --geoip-database=/GeoLite2-City.mmdb \
 # å¿½ç•¥GETè¯·æ±‚æŸ¥è¯¢å‚æ•°
 -q \
 # æœªçŸ¥ç”¨æˆ·ä»£ç†è®¾ä¸ºçˆ¬è™«
 --unknowns-as-crawlers
 # è¾“å‡ºåˆ°webé™æ€è·¯å¾„
 -o /var/www/html/report.html
```

![](https://s2.loli.net/2024/07/30/sEhwaBmQ3NW5oMT.png)

å˜¿ï¼Œå°ä¼™ä¼´ä»¬ï¼Œä½ ä»¬çŸ¥é“å—ï¼Ÿè¿™å­—å„¿å¯ä¸æ˜¯ç™½ç çš„ï¼Œæ¯ä¸€é¢—é”®å¸½ä¸‹çš„æ±—æ°´éƒ½èƒ½æµ‡å‡ºä¸€æœµèŠ±æ¥ï¼æ‰€ä»¥ï¼Œè¦æ˜¯çœ‹å¾—å¼€å¿ƒï¼Œå°±è¯·å¤§æ–¹åœ°æ’’ç‚¹é˜³å…‰â€”â€”è¯„è®ºç‚¹èµè½¬å‘èµ°ä¸€æ³¢ï¼Œè®©æˆ‘è¿™èŠ±å›­æ›´åŠ ç¿çƒ‚ï¼

![](https://s2.loli.net/2024/07/23/gidnr39eTmzqvDY.webp)

## å¾€æœŸç²¾å½©æ–‡ç« 

- [è§£é”Nginxæ—¥å¿—çš„å®è—ï¼šGoAccessâ€”â€”ä½ çš„å®æ—¶ã€äº¤äº’å¼Webæ—¥å¿—åˆ†æç¥å™¨ï¼](https://mp.weixin.qq.com/s/CcbhNsdorentS9jHTwAOMQ)
- [ä½ çš„ç½‘ç«™è®¿å®¢æ¥è‡ªä½•æ–¹ï¼ŸGoAccessåœ°ç†åˆ†æå·¥å…·å‘Šè¯‰ä½ ï¼](https://mp.weixin.qq.com/s?__biz=MzU3NTc1MDMwOQ==&mid=2247484416&idx=1&sn=769d951e80b61b6d9de4d543dfab0a96&chksm=fd1f2dcaca68a4dcc06c741978d3555ad4c2d2cce58cecbdbdfdc0e1278be084c592b1aa7dfd&payreadticket=HArebnqO4mbeqKrubRMmUIqSqlwjekBCPRKSH5bmrwrxcP3pDPPAoUg2kxZjPVpDUIlyjFo#rd)

## æ¬¢è¿æ‰«ç å…³æ³¨

![å¾®ä¿¡å…¬ä¼—å·ã€Œé›ªä¹‹æ¢¦æŠ€æœ¯é©¿ç«™ã€](https://s2.loli.net/2024/07/23/G1JLeUsXThgWFwP.jpg)

> `æ¬¢è¿æ‰«ç å…³æ³¨,ç§ä¿¡å›å¤ã€åŠ ç¾¤ã€ä¸€èµ·äº¤æµæŠ€æœ¯`
